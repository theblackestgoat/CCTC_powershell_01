ROCR-002-W
10.50.29.33
Stack ID 3
start 2347
registry start357
ads start3486

https://vta.cybbh.space/horizon/project/instances/

Intro and Setup
field guide: https://os.cybbh.io/public/os/latest/
navigate to 10.50.21.26:8000
join class W23002 password

What version of PS am I using
PS C:\> Get-Host | Select-Object Version

To switch versions
PS C:\> pwsh

Primer_CLI_1. Which program starts with every CMD and PowerShell instance in Windows 7 and later?

Research: https://devblogs.microsoft.com/commandline/windows-command-line-inside-the-windows-console/

Answer: conhost.exe

Primer_CLI_2. What Windows 10 feature supports installing Linux subsystem?

Research: https://learn.microsoft.com/en-us/windows/wsl/about

Answer: WSL (Windows Subsystem for Linux)

Primer_CLI_3. Which Windows feature can be used to interact with any CLI on the Windows system concurrently using multiple tabs?

Research: https://learn.microsoft.com/en-us/windows/terminal/

Answer: Windows Terminal

Primer_CLI_4. What was the default shell (command line) of Windows versions Windows 2000 through Windows 8.1?

Research: https://learn.microsoft.com/en-us/windows-hardware/customize/enterprise/shell-launcher

Answer: cmd.exe

Primer_CLI_5. What data type do all cmd.exe commands return?

Research: https://en.wikipedia.org/wiki/Comparison_of_command_shells (Hint: What data type is "text"?)

Answer: string

Primer_CLI_6. What framework is PowerShell built on?

Research: https://en.wikipedia.org/wiki/.NET

Answer: .net

Primer_CLI_7. "What will all of the below give you?

(get-host).version

$host.version

$psversiontable.psversion"

Research: https://devblogs.microsoft.com/scripting/powertip-check-version-of-powershell/

Answer: Powershell Version

Primer_CLI_8. After PowerShell Core is installed what CLI command launches it?

Research: https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.2

Answer: pwsh

Primer_CLI_9. "After PowerShell Core is installed you can still run the built in version of PowerShell side-by-side. What CLI command will launch the built in version?"

Research: Primer_CLI_9 https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/powershell

Answer: powershell.exe

Windows_PowerShell_Basics_1. 

What syntax do PowerShell cmdlets follow?

Answer: verb-noun

Windows_PowerShell_Basics_2. What PS command will list all PowerShell cmdlets?

Answer: Get-Command

Windows_PowerShell_Basics_3. What PowerShell command will list all verbs?

Answer: Get-Verb

Windows_PowerShell_Basics_4. BASH commands output strings. PowerShell commands output what data type?

Answer: object
 
Windows_PowerShell_Basics_5. All PowerShell objects are comprised of what two things?

Flag format: things,things

Answer: properties,methods

Windows_PowerShell_Basics_6. What command will list all things that make up a PowerShell object?

Answer: Get-Member

Windows_PowerShell_Basics_7. What PowerShell command will list PowerShell aliases?

Answer: Get-Alias

Windows_PowerShell_Basics_8. What PowerShell command lists all of the contents of a directory?

Answer: Get-ChildItem

Windows_PowerShell_Help_1. What is the basic cmdlet that displays help about Windows Powershell cmdlets and concepts?

Answer: Get-Help

Windows_PowerShell_Help_2. PowerShell "help files" don't show the entire help file with a basic command. What switch option shows the entire help file?

Answer: -Full

Windows_PowerShell_Help_3. What PowerShell command will update the PowerShell "help files" to the latest version?

Answer: Update-Help

Windows_PowerShell_Help_5. What help switch will show you the "help files" on Microsoft's website, in your default browser?

Answer: -Online

Windows_PowerShell_Interaction_1. What command will start the Chrome browser on your machine?

Answer: start chrome

Windows_PowerShell_Interaction_2. What command using a PS Method will stop chrome?

Flag is the full command.

Answer: (get-process chrome).kill()

Windows_PowerShell_Interaction_3. What PowerShell command (without using a method) will stop the Chrome process?

Answer: Stop-Process -name chrome

Windows_PowerShell_CimClasses_1.

PowerShell doesn't have a native cmdlet that will give you processor information (such as get-processor or get-cpu). Knowing this information might be necessary. What command would give you information about the system's processor?

Flag is the full command

Answer: Get-WmiObject -Class Win32_Processor

Windows_PowerShell_Logic_1. What PowerShell command will read a text file?

Answer: Get-Content

Windows_PowerShell_Logic_2. What PowerShell command will allow for counting lines in a file, averaging numbers, and summing numbers?

Answer: Measure-Object

Windows_PowerShell_Regex_1. What PowerShell command searches for text patterns in a string?

Answer: Select-String

Windows_PowerShell_Basics_9. Users' files are stored in their corresponding home directory. What is the literal path to all home directories on a Windows 10 system?

Answer: C:\Users\

Windows_PowerShell_Basics_7. How many properties are available for the get-process cmdlet?

Note: Property values only

Answer: 52

Windows_PowerShell_Alias_3. How many aliases does PowerShell have for listing the contents of a directory?

Answer: 3

Windows_PowerShell_Help_4. When requesting the help file for the get-process cmdlet, what full command is the 9th example given?

Answer: get-process powershell

Windows_PowerShell_CimClasses_2. To complete this challenge, find the description of the Lego Land service.

Get-WmiObject win32_service | ?{$_.NAME -like 'LegoLand'} | select Name,Description

Answer: i_love_legos

Windows_PowerShell_Logic_3. In the CTF folder on the CTF User's Desktop, count the number of words in words2.txt.

(Get-Content .\words2.txt).count

Answer: 5254

Windows_PowerShell_Logic_4. Count the number of files in the Videos folder in the CTF user's home directory.

(Get-ChildItem -Path .\Videos\).count

Andwer: 925

Windows_PowerShell_Logic_5. Find the only line that makes the two files in the CTF user's Downloads folder different.

Hint The flag is the string (not line number).

diff (Get-Content new.txt) (Get-Content old.txt))

Answer: popeye

Windows_PowerShell_Logic_6. The password is the 21st line from the top, in ASCII alphabetically-sorted, descending order of the words.txt file.

**Note: File Location - C:\Users\CTF\Desktop\CTF

(Get-Content .\words.txt | sort -Descending)[20]

Answer: ZzZp

Windows_PowerShell_Logic_7. Count the number of unique words in words.txt

**Note: File Location - C:\Users\CTF\Desktop\CTF

$A = $(foreach ($line in Get-Content .\words.txt) {$line.tolower().split(" ")}) | sort | Get-Unique

$A.count

Answer: 456976

Windows_PowerShell_Basics_8. How many methods are available for the get-process cmdlet?

Machine: Admin_Station

Answer: 14

Windows_Powershell_Logic_9. Count the number of folders in the Music folder in the CTF user’s profile.

(get-ChildItem -Path .\Music\).count

Answer: 411

Windows_PowerShell_Regex_2
10

Count the number of times, case-insensitive, gaab is listed in words.txt **Note: File Location - C:\Users\CTF\Desktop\CTF

(Get-Content .\words.txt | Select-String "gaab").count

Answer: 1

Windows_PowerShell_Regex_3. Count the number of words, case-insensitive, with either a or z in a word, in the words.txt file

    Note: File Location - C:\Users\CTF\Desktop\CTF
    Hint: There are multiple "words" on each line.

$A = $(foreach ($line in Get-Content .\words.txt) {$line.tolower().split(" ")}) -match '[az]+'

$A.count

Answer: 160352

Windows_PowerShell_Logic_8. Use a PowerShell loop to unzip the Omega file 1,000 times and read what is inside.

Note: Make sure you back up the .zip file to a different directory before attempting this challenge.

Omega"$n".zip

for ($n = 1000; $n -gt 0; $n--){Expand-Archive .\omega"$n".zip -DestinationPath .} 

Answer: king-fu

Windows_PowerShell_Regex_5. Count the number of words in words.txt that meet the following criteria:

    a appears at least twice consecutively
    and is followed immediately by any of the letters a through g
    Note: File Location - C:\Users\CTF\Desktop\CTF
    Example: aac...aaa...

$pattern = "[a-g]"    
$A = $(foreach ($line in Get-Content .\words.txt) {$line.tolower().split(" ")}) -match ".*aa$pattern*."
$A.count

Answer: 357

Windows_PowerShell_Profiles_8. Challenge only allows ONE attempt

Malware is running in a PowerShell profile on the File-Server. Based on PowerShell profile order of precedence (what is read first), find the correct flag.

The flag is the string after the #, without the preceding space.

Get-Content $PROFILE.AllUsersAllHosts

Answer: I am definitely not the malware

Windows_PowerShell_Profiles_1.5 Which PowerShell profile has the lowest precedence?

Answer: CurrentUserCurrentHost

Windows_PowerShell_Profiles_2. Which PowerShell profile has the highest precedence?

Answer: AllUsersAllHosts

Windows_PowerShell_Profiles_3. Which PowerShell variable stores the current user’s home directory?

Answer: $HOME

Windows_PowerShell_Profiles_4.

Which PowerShell variable stores the installation directory for PowerShell?

Answer: $PsHome

Windows_PowerShell_Profiles_5. Which PowerShell variable stores the path to the "Current User, Current Host" profile?

Answer: $PROFILE

Windows_PowerShell_Profiles_6. What command would you run to view the help for PowerShell Profiles?

Answer: Get-Help about_profiles

Windows_PowerShell_Profiles_7. What command would tell you if there was a profile loaded for All Users All Hosts?

Flag is the full command syntax

Answer: Test-Path -Path $PROFILE.AllUsersAllHosts




Primer_Registry_1. What Windows registry path is the Volatile Hive?

Research: https://vistech.net/~champ/online-docs/books/mwin2reg/ch11-30975.html

Answer: HKLM\HARDWARE

Primer_Registry_2. What registry key creates the Wow6432Node to represent 32-bit applications that run on a 64-bit version of Windows?

Research: https://learn.microsoft.com/en-us/troubleshoot/windows-client/application-management/wow6432node-registry-key-present-32-bit-machine

Answer: HKEY_LOCAL_MACHINE\SOFTWARE

Primer_Registry_3. In what registry path are the BOOT_START drivers located?

Research: https://learn.microsoft.com/en-us/windows-hardware/drivers/install/hklm-system-currentcontrolset-services-registry-tree

Answer: HKLM\SYSTEM\CurrentControlSet\Services

Primer_Registry_4. What start value do BOOT_START drivers have in the registry?

Research: https://learn.microsoft.com/en-us/windows-hardware/drivers/install/specifying-driver-load-order

Answer: 0x0

Primer_Registry_5. During kernel initialization, what registry location is read containing all SYSTEM_START drivers and services with a start value of 0x1?

Research: https://learn.microsoft.com/en-us/windows-hardware/drivers/install/hklm-system-currentcontrolset-services-registry-tree

Answer: HKLM\SYSTEM\CurrentControlSet\Services

Primer_Registry_6. Auto_START drivers and services are loaded after kernel initialization. What start value do they have in the registry?

Research: https://learn.microsoft.com/en-us/windows-hardware/drivers/install/specifying-driver-load-order

Answer: 0x02

Primer_Registry_7. What start value do DEMAND_START drivers and services have in the registry?

Research: https://learn.microsoft.com/en-us/windows-hardware/drivers/install/specifying-driver-load-order

Answer: 0x3

Primer_Registry_8. When accessing a remote registry which are the only 2 accessible HKEYs?

SYNTAX Hive, Hive

Research: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/reg-load

Answer: HKLM, HKU

Primer_Registry_9. What PowerShell cmdlet will list currently mapped drives?

Research: https://learn.microsoft.com/en-us/powershell/scripting/samples/managing-windows-powershell-drives?view=powershell-7.2

Answer: Get-PSDrive

Primer_Registry_10. What is the native Windows GUI tool for managing the registry?

Research: https://support.microsoft.com/en-us/windows/how-to-open-registry-editor-in-windows-10-deab38e6-91d6-e0aa-4b7c-8878d9e07b11

Answer: regedit.exe

Windows_Registry_Basics_1. What registry hive contains all machine settings?

Answer: HKEY_LOCAL_MACHINE

Windows_Registry_Basics_2. What registry hive contains all user settings?

Answer: HKEY_USERS

Windows_Registry_Basics_3. What registry hive contains only the currently logged-in user's settings?

Answer: HKEY_CURRENT_USER

Windows_Registry_Basics_4. The HKEY_CURRENT_USER registry hive is a symbolic link to another registry subkey. What is the subkey that it is linked to?

Flag format: HIVE\SID.........................

Answer: HKEY_USERS\S-1-5-21-105181296-3876013222-3871917967-1000

Windows_Registry_Basics_5. What PowerShell command will list all the subkeys and contents in the current directory and/or will list all the subkeys and the contents of a directory you specify?

Answer: Get-ChildItem

Windows_Registry_Basics_6. What PowerShell command will list only the contents of a registry key or subkey?

Answer: Get-Item

Windows_Registry_Basics_7. What registry subkey runs every time the machine reboots? The flag is the full path, using PowerShell.

Flag format: FULL\PATH\ALL\CAPS

Answer: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

Windows_Registry_Basics_8. What registry subkey runs every time a user logs on? The flag is the full path, using PowerShell.

Flag format: FULL\PATH\ALL\CAPS

Answer: HKEY_CURRENT_USER\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUN

Windows_Registry_Basics_9. What registry subkey runs a single time, then deletes its value once the machine reboots? The flag is the full path, using PowerShell.
get
Flag format: FULL\PATH\ALL\CAPS

Answer: HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUNONCE

Windows_Registry_Basics_10. What registry subkey runs a single time, then deletes its value when a user logs on? The flag is the full path, using PowerShell.

Flag format: FULL\PATH\ALL\CAPS

Answer: HKEY_CURRENT_USER\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUNONCE

Windows_Registry_Basics_11. What is the value inside of the registry subkey from your previous challenge named registry_basics_7?

CMD:
C:\Users\andy.dwyer>reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run                                                                                                                                        HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run                                                            SecurityHealth    REG_EXPAND_SZ    %ProgramFiles%\Windows Defender\MSASCuiL.exe                                         
Kaspersky    REG_SZ    C:\malware.exe 

PS:
Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"

Answer: malware.exe

Windows_Registry_Basics_12. What is the value inside of the registry subkey that loads every time the "Student" user logs on?

To get the "student" SID:
Get-WmiObject -Class Win32_UserAccount -Filter "Name='student'"
Make a new PSDrive
New-PSDrive -Name HKU -PSProvider Registry -Root HKEY_USERS
Navigate into that new drive
cd Registry::HKEY_LOCAL_MACHINE 
cd HKU:
CD into the SID for the student
Get-ItemProperty
then provide the filepath

Answer: C:\botnet.exe

Windows_Registry_Basics_13. What is the value inside of the registry subkey from registry_basics_9?

Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce"

Answer: Virus.exe

Windows_Registry_Basics_14. What is the value inside of the registry subkey that loads a single time when the "student" user logs on?

Look at how to do #12

Answer: C:\worm.exe

Windows_Registry_Basics_15. Figure out the manufacturer's name of the only USB drive that was plugged into this machine.

Get-ChildItem - path "HKLM:\SYSTEM\CurrentControlSet\Enum\USB*"

Answer" SanDisk

Windows_Registry_Basics_16. What suspicious user profile, found in the registry, has connected to this machine?

Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList"

Answer: Hacker_McHackerson

Windows_Registry_Basics_17. What suspicious wireless network, found in the registry, has this system connected to?

Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles"

Answer: Terror_cafe_network




Primer_NTFS_1. The ____ determines how the data is stored on disk.

(Fill in the blank)

Research: https://social.technet.microsoft.com/wiki/contents/articles/5375.windows-file-systems.aspx

Answer: file system

Primer_NTFS_2. What are NTFS partition sectors grouped into?

Research: https://learn.microsoft.com/en-us/windows-server/storage/file-server/ntfs-overview

Answer: clusters

Primer_NTFS_3. What contains the metadata about all of the files and directories on a NTFS partition?

Research: https://learn.microsoft.com/en-us/windows/win32/devnotes/master-file-table

Answer: master file table

Primer_NTFS_4. NTFS files are collections of what?

(Hint: What are the user data streams? or all streams for that matter) Research: https://learn.microsoft.com/en-us/windows/win32/devnotes/master-file-table

Answer: attributes

Primer_NTFS_5. Which NTFS attribute would store an alternate data stream?

Research: https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/c54dec26-1551-4d3a-a0ea-4fa40f848eb3

Answer: $DATA

Primer_NTFS_6. Which NTFS attribute holds information about a file's encrypted attributes?

Research: https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/a82e9105-2405-4e37-b2c3-28c773902d85

Answer: $LOGGED_UTILITY_STREAM

Primer_NTFS_7. Which NTFS attribute that is composed of the file security and access control properties?

Research: https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/a82e9105-2405-4e37-b2c3-28c773902d85

Answer: $SECURITY_DESCRIPTOR

Primer_NTFS_8. In NTFS, what is the type id, in hex, of the attribute that actually stores a NTFS files contents?

Research: https://flatcap.github.io/linux-ntfs/ntfs/attributes/data.html

Answer: 0x80

Primer_NTFS_9. In NTFS what is the maximum number of bytes a MFT entry (containing the entirety of a file) can contain to be considered "Resident Data"?

Research: https://www.sciencedirect.com/topics/computer-science/master-file-table https://en.wikipedia.org/wiki/NTFS

Answer: 1024

Primer_NTFS_10. NTFS permissions can be a assigned to a filesystem object in two ways. Which way is intentionally assigned on the file or folder?

Research: https://devblogs.microsoft.com/scripting/weekend-scripter-use-powershell-to-get-add-and-remove-ntfs-permissions/

Answer: explicit ( as opposed to inheritance )

Primer_NTFS_11, NTFS permissions can be a assigned to a filesystem object in two ways. Which way is the results of an object being assigned permissions as the result of being the child of another object?

Research: https://devblogs.microsoft.com/scripting/weekend-scripter-manage-ntfs-inheritance-and-use-privileges/

Answer: Inheritance

Primer_NTFS_12. Which NTFS file level permission is missing from the following list? Write, Read & Execute, Modify, Full Control

Research: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc783530(v=ws.10)?redirectedfrom=MSDN

Answer: read

Primer_NTFS_13. Which NTFS folder level permission is missing from the following list?: Read, Write, Read & Execute, Modify, Full control

Research: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc783530(v=ws.10)?redirectedfrom=MSDN

Answer: list folder contents

Primer_NTFS_14. Which NTFS file level permission permits changing the contents of a file, deleting the file but does not allow the ability to change the permissions on the file?

Research: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc783530(v=ws.10)?redirectedfrom=MSDN

Answer: modify

Primer_NTFS_15. Which NTFS folder level permission allows changing permissions?

Research: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc783530(v=ws.10)?redirectedfrom=MSDN

Answer: full control

Primer_NTFS_16. Which NTFS attribute stores the file times of an object?

Research: https://flatcap.github.io/linux-ntfs/ntfs/attributes/standard_information.html

Answer: $STANDARD_INFORMATION

Primer_NTFS_17. What CLI command will only show the letters of attached drives? **Hint command is 3 words

Research: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-fsinfo

Answerfsutil fsinfo drives

Windows_File_System_Basics_1. Every file on a Windows system has attributes. What does the d attribute mean?

Answer: directory

Windows_File_System_Basics_2. Every file on a Windows system has attributes. What does the h attribute mean?

Answer: hidden

Windows_File_System_Basics_3. What PowerShell command will list all files in the current directory, regardless of their attributes?

Answer: Get-ChildItem -Force

Windows_File_System_Basics_4. What PowerShell command will give you the sha512 hash of a file?

Flag format: command -argument

Answer: Get-FileHash -Path <your file path> -Algorithm SHA512

Windows_File_System_Basics_5. What PowerShell command will list permissions of a file?

Answer: Get-ACL (Access Control List)

Windows_File_System_Basics_6. What Windows file maps hostnames to IP addresses?

Answer: hosts

Windows_File_System_Basics_7. Which group has ReadandExecute (RX) permissions to the file listed in the previous challenge, File_System_Basics_6?

Get-ACL C:\Windows\System32\drivers\etc\hosts | Fprmat-List Property *

Answer: BUILTIN\Users

Windows_File_System_Basics_8. Find the last five characters of the MD5 hash of the hosts file.

Get-FileHash .\hosts -Algorithm MD5

Answer: Just read the last 5 characters

Windows_File_System_Basics_9. Examine the readme file somewhere in the CTF user’s home directory.

Get-ChildItem -Path C:\Users\computerperson\ -Include *readme* -Recurse -ErrorAction SilentlyContinue

Answer: 123456

Windows_File_System_Basics_10. There is a hidden directory in the CTF user's home directory. The directory contains a file. Read the file.

cd into the CTF home directory
Get-ChildItem -Force

Answer: ketchup

Windows_File_System_Basics_11. Find a file in a directory on the desktop with spaces in it. FLAG is the contents of the file

HINT: If you like to type the full names and paths of files, you better look for a shortcut.

Answer: 987654321

Windows_File_System_Basics_12. Find the Alternate Data Stream in the CTF user's home, and read it.

This is kinda ridiculous but...

Get-ChildItem -Path "C:\Users\Username" -Recurse | ForEach-Object { $filePath = $_.FullName; $streamList = Get-Item -Path $filePath -Stream * | Where-Object { $_.Length -gt 0 }; if ($streamList) { Write-Output "Alternate Data Streams found in file: $filePath"; $streamList | Format-Table -Property Stream, Length -AutoSize; Write-Output "------------------" } }

Run this and look for alternate data streams. 

navigate to directory of interest and search for ADS with dir /R * or PS Get-ChildItem -Force *

then read the content of ex. nothing_here:hidden:$DATA

Answer: P455W0RD


































